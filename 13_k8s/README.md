# 1
Выполняем сборку образа и пуш его в репозиторий
```bash
docker build --tag=aesedeu/nginx-shvm-ai:1.0 --file=Dockerfile .
docker push aesedeu/nginx-shvm-ai:1.0

# для локального запуска можно выполнить
docker run --rm -p 80:80 aesedeu/nginx-shvm-ai:1.0
```

# 2
- Запуск minikube
```minikube start --vm-driver=docker --cpus=3 --memory=3G --nodes=3```
- Проверка адреса minikube
```minikube ip```
- Установка аддона
```minikube addons enable ingress```
- Запускаем сущности из директории (под + сервис + ингресс)
```kubectl apply -f .```
- Открываем туннель (для macOS) для Ingress
```minikube tunnel```
- Дописываем в `/etc/hosts`:
```
192.168.49.2            shvm-ai.ru
127.0.0.1               shvm-ai.ru
```

Переходим в бразуер на адрес

# 3
- Удаляем под и видим что теперь ошибка 503 в браузере
- Поднимаем под и видим что все еще недоступен
- Нам поможет RS, поднимаем его и видим что у нас 4 пода (1 из POD и 3 из RS). Прилетают разные ответы
- Удаляем старый под и видим что он автоматически возвращается
- Теперь применяем деплоймент. Можно удалить RS (перемещаем его и под в `move_after_use`)
- Смотрим ревизию деплоймента `kubectl rollout history deployment/shvm-deployment`
- Меняем образ контейнера, видим постепенно обновление контейнеров
- Пробуем выполнить откат (при это файл деплоймента не будет изменен) `kubectl rollout undo deployment shvm-deployment`
- Создаем CM и приписываем его в деплоймент (`/etc/config`)
- Создаем секреты. Для конвертации из base64:
```
echo -n 'admin' | base64     # → YWRtaW4=
echo -n 'secret' | base64    # → c2VjcmV0
```
- Прокидываем их в деплоймент

# 4
Можно дополнительно создать еще один деплоймент, приклеить к нему сервис и прокинуть его на ингресс на отдельный путь